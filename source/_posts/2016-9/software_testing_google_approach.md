---
title: "(Reproduce) 《Google软件测试之道》摘录"
date: 2016/09/30 13:347
categories: Java
tags:
- Java
- String
---
[Original Post](http://silencewt.github.io/2015/06/05/《Google软件测试之道》摘录/)

以下是最近看的一本书《Google软件测试之道》里的一些摘录，收获很多。

1. 讨论测试开发比并没有什么意义，如果你是一名开发人员，同时也是一名测试人员，如果你的职位头衔上有测试的字样，你的任务就是使那些头衔上没有测试的人可以更好的去做测试。

2. 只有在软件产品变得重要的时候质量才显得重要。

3. 假如你被要求去实现一个函数count（void *）返回一个字符串中大写字母A出现的次数。如果候选人上来就直接开始写代码，这无非在传递一个强烈的信息，只有一件事情需要去做而我正在做这个事情，这个事情就是写代码。SET不会遵循这样的世界观，他们会先把问题搞清楚。

这个函数是用来做什么的?我们为什么要构建它？这个函数的原型看起来正确吗？我们期望候选人可以关心函数的正确性以及如何验证期望的行为。一个问题值得更多的关注!候选人如果没头没脑地就跳进来编码，试图解决问题，在对待测试问题上他同样会没头没脑。如果我们提出一个问题是给模块增加测试场景，我们不希望候选人上就直接开始罗列所有可能的测试用例，直到我们强迫他停下来。其实我们只是希望他先执行最佳的测试用例。

SET的时间是有限的。我们希望候选人能够回过头来寻找最有效的解决问题的方法，为先前的函数定义可以做一些改进。优秀的SET在面对拙劣的API定义的情况下，在测试的过程中也可以把这个API定义变得更漂亮些。

**普通的候选人**会花几分钟通过提问题和陈述的方式来理解需求文档，例如以下几点。
* 传入的字符串编码是什么：ASCII, UTF-8或其他的编码方式?
* 函数名字比较槽糕，应该是驼峰式(CamelCased)的?需要更多说明描述，还是这里应该遵循其他的什么命名规范?
* 返回值类型是什么(或许面试官忘记了，所以我会增加一个int类型的返回值在函数原型之前)?
* 如果只有一个A的情况，计数结果是多少?它对小写字母a也计数吗?
* 在标准库中不是已经有这样的函数了吗(为了面试的目的，假装你是第一个实现这个函数功能的人)?

**更好的候选人**则会考虑的更多一些。
* 考虑下扩展性：或许返回值的类型应该是1个64位的整形，因为Google经常涉及海量数据。
* 考虑下复用性：为什么这个函数是针对大写字母A进行计数的?一个好的办法是参数化，使得任意的字符都可以被计数，而不是使用不同的函数来实现。
* 考虑下安全性：这此指针都是来自于可信任的地址吗?

**最佳的候选人**会这样考虑。
* 考虑扩展
  > 这个函数会在Shared data(译注:数据分区，是数据库存储分割(partition)的一种方式。水平分割是一个数据库的设计一准则，数据以记录行的方式存储在不同的物理位置，而不是通过不同列的方式存储。或许这才是调用这个函数最有用的形式。在这个场景需要考虑一些什么问题吗?针对整个互联网的所有文档运行这个函数，该如何考虑性能和正确性?
  > 
  > 如果这个子程序被每一个Google查询所调用，而且由于外部的封装层面已经对参数做了验证，传递的指针是安全的，或许减少1个空指针的检查会每天节省上亿次的cpu调用周期，井缩短用户的响应时间。最少要理解全部参数验证所带来的潜在影响。
* 考虑基于常量的优化
  > 我们可以假设输入的数据是已经排好顺序的吗？如果是那样，我们或许可以在找到第个大写字母B之后就快速退出。输入的数据是什么结构?多数情况下都是A吗?多数是字符的混合，还是只包含字毋A和空格？如果那样，在我们比较指令的地方或许可以做些优化。当在处理大数据，甚至小数据的时候，在代码执行的时候对于真实的计算延迟也会有比较显著的亚线性变化。
* 考虑安全性
  > 在许多系统上，如果这是一段对于安全敏感的代码，可以考虑更多的非空的指针做测试，在某些系统上，1是一个非法指针。
  > 
  > 增加一个字符长度的参数，用以保证代码不会运行到指定字符串之外的部分。检查字符串长度，这个参数的值是否正常。那些不是以null结尾的字符串是黑客们的最爱。
  > 
  > 如果指针指向的数据能被其他的线程修改，这里就有潜在的线程安全问题。
  > 
  > 我们是否应该使用try/catch来捕获异常的发生？或者如果未能如预期那样正常的调用代码，我们或许应该返回错误代码给调用者。如果有错误代码的话，这些代码经过良好的定义并有文档吗？这意味着候选人在思考大型代码库和运行时刻的上下文环境方面的问题，这样的思索可以避免错误代码的重复和遗漏。

4. 在Google，如果测试运行失败需要清除的知道测试代码在做什么，否则这个测试就应该被禁止掉，或者被标记为怪异的测试，或是忽略这个测试的运行失败，这个问题如果发生了，这是编写出坏代码的SWE的责任，或是代码审查时给予通过的投票的SWE或SET的责任。

5. 使用白盒测试知道哪些用例是无效的：

通常情况下，**普通的候选人**会这样做。
* 他们会比较有条理地或体系化地提供特定的字符串(如不同的字符串大小)而不是随机的字符串。
* 专注于产生有意义的测试数据。考虑如何去运行大型测试和使用真实环境的数据做测试。

**更优秀的候选人**会这样做的更多一些。
* 在并发线程中调用这个函数，去查看在串扰(cross talk )、死锁和内存泄露方面是否存在问题。
* 构建长时间持续运行的测试场景。例如在一个while(true)循环中调用函数，并确保他们在不间断地长时间运行过程中保持功能正常。
* 在构建测试用例、测试数据的产生方法、验证和执行上保持浓厚的兴趣。

6. Selenium在浏览器内部使用JavaScript实现，而WebDriver使用浏览器本身的API集成到浏览器内部。两种方法各有优劣。例如，Selenium可以在瞬间打开一个新的Chrome浏览器，但却不能上传文件或者很好地处理用户交互，因为它是JavaScript实现，必须限定在JS沙箱之内。由于WebDriver构建在浏览器里面，它可以突破这些限制，但打开个新的浏览器却比较痛苦。在我们都开始为Google工作的时候，我们决定把这两个集成到一起。

7. 风险分析
* 哪些事件需要担心
* 这些事件发生的可能性有多大?
* 一旦发生，对公司产生多大影响?
* 一旦发生，对客户产生多大影响?
* 产品具备什么缓解措施?
* 这些缓解措施有多大可能会失败?
* 处理这些失败的成本有哪些？
* 恢复过程有多困难?
* 事件是一次性问题，还是会再次发生?

8、对于一个web测试页面，一个文本输入框，一个计数按钮，用于计算一个字符串中大写字母A出现的个数。请设计出一系列字符串来测试这个web页面。

一些候选人头扎进去开始罗列测试用例，这往往是一个危险的信号，说明他们还没有充分思考这个问题。根据我们的经验，追求数量而非质量的倾向，是一种低效的工作方式，因此会给负面评价。通过观察候选人在找到答案之前思考和解决问题的方式，能了解他们很多东西。

更好的是那些会提出一些问题，**来做进一步澄清的候选人**：大写还是小写？只是英语吗？计算完成后文本会被清除吗？多次按下按钮会发生什么事情？诸如此类。在问题被澄清之后，候选人开始列举测试用例。重点观察他们是否使用一些疯狂的做法。他们只是在试图破坏软件，还是同时在验证它能正常工作？他们知道这两者的区别吗？他们是否能从最显而易见的简单的输入开始，尽快地发现大bug?他们能清晰地列出测试计划或数据吗?在白板上随机摆放字符串不能反映出思路的清晰性，他们很可能毫无测试计划，或者只有很粗糙很随意的测试计划。

一个典型的列表如下：
* "banana": 3（一个合法的英文字）
* "A"和"a": 1（一个简单的有正常）
